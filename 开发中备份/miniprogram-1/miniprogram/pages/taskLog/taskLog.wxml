<import src="../public/public.wxml" />
<template is="custom" />

<van-tabs bind:disabled="onClick_statistic" z-index="{{101}}">
  <van-tab title="日志">
    <!-- header -->
    <van-sticky offset-top="{{ 60 }}">
      <view style="border-bottom:1px solid #F5F6F8">
        <van-search
          name="search_value"
          placeholder="支持: 时间 任务名搜索"
          bind:search="onSearch"
          bind:cancel="onCancel_search"
          show-action
          shape="round"
          action-text=" 还原"
          background="#fff"
        />
      </view>
    </van-sticky>

    <!-- content -->
    <view class="padding" wx:for="{{tasks}}">
      <view class="padding-xl radius shadow bg-white">
        <van-row>
          <van-col span="12" class="text-left">
            <view style="font-size:20px;color:#000000;">{{tasks[index].time}}</view>
          </van-col>
          <van-col span="12" class="text-right">
            <view>今日总完成: {{tasks[index].types.today_completed_count+tasks[index].types.everyday_completed_count+tasks[index].types.limitTime_completed_count}}</view>
          </van-col>
        </van-row>
      </view>
      <view class="padding-xl radius shadow bg-white" wx:for="{{tasks[index].types}}" wx:for-item="items" wx:for-index="indexes" wx:if="{{m.noFindChar('_',indexes)}}">
        <!-- content-header -->
        <view>
          <van-row>
            <van-col span="12">
              <text>{{indexes}}</text>
            </van-col>
            <van-col class="text-right" span="12">
              <text>完成: {{tasks[index].types[m.combineCompleteCountStr(indexes)]}}</text>
            </van-col>
            <!-- <van-col span="16" class="text-right">
              <view style="font-size:14px;color:#353535;">
                今日花支: {{item.day_spend}}
              </view>
              <view style="font-size:14px;color:#353535;">
                今日收入: {{item.day_income}}
              </view>
            </van-col> -->
          </van-row>
        </view>

        <van-divider hairline />

        <!-- content-content -->
        <!-- wx:for="{{items}}" wx:for-item="datas" -->
        <view>
          <van-swipe-cell right-width="{{ 110 }}" disabled="{{true}}">
            <van-row>
              <van-col span="2">
                <text style="font-size:20px;" class="cuIcon-question"></text>
              </van-col>
              <van-col span="14">
                <view>
                  <text style="color:{{items.color}};word-break: keep-all;word-wrap: break-word;font-size:14px;">任务1</text>
                </view>
              </van-col>
              <van-col span="8">
                <view class="text-right" style="color:#b2b2b2;font-size:11px;">22:22:22</view>
              </van-col>
            </van-row>

            <view slot="right" style="height:100%;">
              <van-button custom-style="height:100%;" type="primary" bind:click="edit" id="{{items.id}}" data-title="{{index}}">编辑</van-button>
              <van-button custom-style="height:100%;" type="danger" bind:click="delete" id="{{items.id}}" data-name="{{items.name}}" data-title="{{index}}">删除</van-button>
            </view>
          </van-swipe-cell>
        </view>

      </view>
    </view>
    <!-- content end -->
  </van-tab>

  <!-- 统计页 -->
  <van-tab title="统计" disabled title-style="color:#323233;"></van-tab>
</van-tabs>

<van-divider hairline contentPosition="center">已经到底啦</van-divider>
<van-divider hairline />
<van-divider hairline />
<van-divider hairline />

<van-dialog id="van-dialog" />

<van-dialog
  use-slot
  title="编辑"
  show="{{ show_edit_dialog }}"
  show-cancel-button
  bind:close="onClose_edit_dialog"
  bind:confirm="update"
>
  <van-row>
    <van-col offset="2" span="20">
      <van-field
        label="注释"
        placeholder="请输入注释"
        value="{{spendLogData.comment}}"
        border="{{ false }}"
        bind:change="onChange_spendLogData_comment"
      />
    </van-col>
    <van-col span="2"></van-col>
  </van-row>

  <view>
    <van-row>
      <van-col offset="2" span="8">
        <van-cell title="消费类型"></van-cell>
      </van-col>
      <van-col span="12">
        <van-cell title="{{spendLogData.spend_type}}">
          <view slot="icon">
            <text class="cuIcon-{{spendLogData.icon}}"></text>
          </view>
        </van-cell>
      </van-col>
      <van-col span="2"></van-col>
    </van-row>

    <!-- 分类块 -->
    <van-row>
      <van-col offset="4" span="20">  
        <view style="display:inline-block;margin:5rpx 10rpx 5rpx 0rpx;" wx:for="{{spend_types}}">
          <van-cell clickable title="{{item.text}}" size="mini" bind:click="edit_choose_type" data-text="{{item.text}}" data-icon="{{item.icon}}">
            <view slot="icon"><text class="cuIcon-{{item.icon}}"></text></view>
          </van-cell>
        </view>
      </van-col>
    </van-row>
  </view>
</van-dialog>

<!-- wxs_toFixed实现 -->
<wxs module="m">
  var noFindChar= function (find,str) {
    return str.indexOf(find)>=0?false:true;
  }
 module.exports.noFindChar=noFindChar;
 var combineCompleteCountStr= function (str) {
    return str+'_completed_count';
  }
 module.exports.combineCompleteCountStr=combineCompleteCountStr;
</wxs>